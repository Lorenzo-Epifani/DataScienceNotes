%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%% CHAPTER STYLE %%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%NUMBERED CHA
\titleformat{\chapter}[display]
  {\normalfont\huge\bfseries}
  {}
  {20pt}
  {%
    \begin{tcolorbox}[
      borderline north = {0.65mm}{3.2mm}{black},
      borderline south = {0.65mm}{3.2mm}{black},
      enhanced,
      colback=BGF,
      boxrule=0.25cm,
      colframe=FRM,
      arc=0pt,
      outer arc=0pt,
      leftrule=0pt,
      rightrule=0pt,
      fontupper=\color{black}\sffamily\bfseries\huge,
      enlarge left by=-1in-\hoffset-\oddsidemargin, 
      enlarge right by=-\paperwidth+1in+\hoffset+\oddsidemargin+\textwidth,
      width=\paperwidth, 
      left=1cm+\hoffset+\oddsidemargin, 
      right=\paperwidth-1in-\hoffset-\oddsidemargin-\textwidth,
      top=0.9cm, 
      bottom=0.15cm,
      overlay={
        \node[
          circle, 
          fill=BGF,
          draw=FRM,
          line width=0.20cm,
          inner sep=0pt,
          text width=2cm,
          minimum height=2cm,
          align=center,
          font=\color{black}\sffamily\bfseries\fontsize{30}{36}\selectfont
        ] 
        (chapname)
        at ([xshift=-4cm]frame.north east)
        {\huge \scalebox{1.7}{\thechapter}};
        \node[font=\small,anchor=south,inner sep=2pt] at (chapname.north)
        {\scalebox{1.5}{\MakeUppercase\chaptertitlename}};  % if using amsbook, this should be \chaptername
      } 
    ]
    \scalebox{1}{#1}
    \end{tcolorbox}%
    \vspace{-2.5cm}
  }


%%%% UNNUMBERED  CHA
\titleformat{name=\chapter,numberless}[display]
  {\normalfont\huge\bfseries}
  {}
  {20pt}
  {%
    \begin{tcolorbox}[
      borderline north = {0.65mm}{3.2mm}{black},
      borderline south = {0.65mm}{3.2mm}{black},
      enhanced,
      colback=BGF,
      boxrule=0.25cm,
      colframe=FRM,
      arc=0pt,
      outer arc=0pt,
      leftrule=0pt,
      rightrule=0pt,
      fontupper=\color{black}\sffamily\bfseries\huge,
      enlarge left by=-1in-\hoffset-\oddsidemargin, 
      enlarge right by=-\paperwidth+1in+\hoffset+\oddsidemargin+\textwidth,
      width=\paperwidth, 
      left=1cm+\hoffset+\oddsidemargin, 
      right=\paperwidth-1in-\hoffset-\oddsidemargin-\textwidth,
      top=0.9cm, 
      bottom=0.15cm,
    ]
    \scalebox{1}{#1}
    \end{tcolorbox}%
    \vspace{-2.5cm}
  }
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%% SECTION STYLE %%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  

%NUMBERED SEC
\titleformat{\section}[display]
  {\normalfont\large\bfseries}
  {}
  {20pt}
  {%
    \begin{tcolorbox}[
      enhanced,
      hbox,
      colback=FRM,
      boxrule=0.07cm,
      colframe=black,
      arc=0pt,
      outer arc=0pt,
      leftrule=0pt,
      rightrule=0.07cm,
      fontupper=\color{black}\sffamily\bfseries\Large,
      enlarge left by=-1in-\hoffset-\oddsidemargin, 
      enlarge right by=-\paperwidth+1in+\hoffset+\oddsidemargin+\textwidth,
      width=\textwidth, 
      left=0.4in+\hoffset+\oddsidemargin, 
      right=\paperwidth-1in-\hoffset-\oddsidemargin-\textwidth,
      top=0.5cm, 
      bottom=0.1cm,
      overlay={
        \node[
          fill=BGF ,
          draw=FRM,
          line width=0.07cm,
          inner sep=0pt,
          text width=5cm,
          minimum height=0.8cm,
          align=center,
          font=\color{black}\sffamily\bfseries\fontsize{30}{36}\selectfont
        ] 
        (chapname)
        at ([xshift=+3cm, yshift=+4pt ]frame.north west)
        {\Large Section: \thesection};
        \node[font=\small,anchor=south,inner sep=2pt] at (chapname.north)
        {};  % if using amsbook, this should be \chaptername
               \draw[line width=8pt, BGF] (0,-0.06) -- (0.8\paperwidth,-0.06);
      } 
    ]
    \scalebox{1.1}{\textcolor{white}{#1}}
    \end{tcolorbox}%
    \vspace{-1cm}
  }
  
% UNNUMBERED SEC
\titleformat{name=\section, numberless}[display]
  {\normalfont\large\bfseries}
  {}
  {20pt}
  {%
    \begin{tcolorbox}[
      enhanced,
      hbox,
      colback=FRM,
      boxrule=0.07cm,
      colframe=black,
      arc=0pt,
      outer arc=0pt,
      leftrule=0pt,
      rightrule=0.07cm,
      fontupper=\color{black}\sffamily\bfseries\Large,
      enlarge left by=-1in-\hoffset-\oddsidemargin, 
      enlarge right by=-\paperwidth+1in+\hoffset+\oddsidemargin+\textwidth,
      width=\textwidth, 
      left=0.4in+\hoffset+\oddsidemargin, 
      right=\paperwidth-1in-\hoffset-\oddsidemargin-\textwidth,
      top=0.5cm, 
      bottom=0.1cm,
      overlay={
      \node[
          anchor=south,
          fill=BGF,
          line width=0pt,
          inner sep=0pt,
          text width=\paperwidth,
          right=2cm,
          minimum height=0.9mm,
          align=center,
        ] 
        (aa)
        at ([xshift=-2cm,yshift=-1.5cm]frame.north west)
        {};
        \draw[line width=8pt, BGF] (0,-0.06) -- (0.8\paperwidth,-0.06);}
    ]
    \scalebox{1.1}{\textcolor{white}{#1}}
    \end{tcolorbox}%
    \vspace{-1cm}
  }
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%% SUBSECTION STYLE %%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%NUMBERED SUB
\titleformat{\subsection}[display]
  {\normalfont\large\bfseries}
  {}
  {20pt}
  {%
    \begin{tcolorbox}[
      enhanced,
      hbox,
      colback=BGF,
      boxrule=0pt,
      colframe=FRM,
      arc=0pt,
      outer arc=0pt,
      leftrule=0pt,
      rightrule=0pt,
      fontupper=\color{black}\sffamily\bfseries\Large,
      width=\textwidth-3cm, 
      left=0.3in,
      enlarge left by=-1in-\hoffset-\oddsidemargin, 
      right=\paperwidth-1in-\hoffset-\oddsidemargin-\textwidth,
      top=0.1cm, 
      bottom=0.1cm,
      overlay={
        \node[
          fill=FRM,
          line width=0pt,
          inner sep=0pt,
          text width=5cm,
          minimum height=0.8cm,
          align=center,
          font=\color{black}\sffamily\bfseries\fontsize{30}{36}\selectfont
        ] 
        (chapname)
        at ([xshift=+1.8cm, yshift=+12pt]frame.north west)
        {\small  \textcolor{white}{Subsection \thesubsection:} };
        \node[font=\small,anchor=south,inner sep=2pt] at (chapname.north)
        {};  % if using amsbook, this should be \chaptername
      } 
    ]
    \scalebox{0.9}{#1}
    \end{tcolorbox}%
    \vspace{-0.8cm}
  }
  
%UNNUMBERED SUB
\titleformat{name=\subsection,numberless}[display]
  {\normalfont\large\bfseries}
  {}
  {20pt}
  {%
    \begin{tcolorbox}[
      enhanced,
      hbox,
      colback=BGF,
      boxrule=0pt,
      colframe=FRM,
      arc=0pt,
      outer arc=0pt,
      leftrule=0pt,
      rightrule=0pt,
      fontupper=\color{black}\sffamily\bfseries\Large,
      width=\textwidth-3cm, 
      left=0.3in,
      enlarge left by=-1in-\hoffset-\oddsidemargin, 
      right=\paperwidth-1in-\hoffset-\oddsidemargin-\textwidth,
      top=0.1cm, 
      bottom=0.1cm,
    ]
    \scalebox{0.9}{#1}
    \end{tcolorbox}%
    \vspace{-0.8cm}
  }
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%% HEADER AND FOOTER %%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\fancypagestyle{myheader}{%
  \fancyhf{}% Clear all headers/footers
  \fancyhead[R]{%
  \begin{tcolorbox}[enhanced,hbox,
  arc=0pt,
  outer arc=0pt,
  left=2pt,
  right=2pt,
  top=2pt,
  bottom=2pt,
  leftrule=0pt,
  bottomrule=1.5pt,
  rightrule=1.5pt,
  toprule=1.5pt,
  colback=BGF,colframe=FRM]
  \hfill \leftmark
\end{tcolorbox}\vspace{-32pt}}% Header Centred
  \fancyfoot[C]{\thepage}% Footer Centred
  %\fancyfoot[L]{\rightmark}
  
  \renewcommand{\headrulewidth}{1.5pt}% 2pt header rule
  \renewcommand{\headrule}{\hbox to\headwidth{%
    \color{FRM}\leaders\hrule height \headrulewidth\hfill}}
    
  \renewcommand{\footrulewidth}{2pt}% No footer rule
  \renewcommand{\footrule}{\hbox to\headwidth{%
    \color{FRM}\leaders\hrule height \footrulewidth\hfill}}
}
\setlength{\headheight}{21pt}%
\pagestyle{myheader}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%DEFINITIONS/PROPERTIES/THEOREMS  STYLE  %%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\theoremstyle{definition}

%customdef
\newmdtheoremenv[linewidth=2.0pt,%
backgroundcolor=gray!8!blue!5,
innertopmargin=0pt,
linecolor=blue!40,%
roundcorner=5pt,%
]
{customDef}{\colorbox{blue!40}{Definition}}[chapter]

%customProp
\newmdtheoremenv[linewidth=2.0pt,%
backgroundcolor=gray!8!red!5,
innertopmargin=0pt,
linecolor=red!40,%
roundcorner=5pt,%
]{customProp}{\colorbox{red!40}{Property}}[chapter]

%customTheo
\newmdtheoremenv[linewidth=2.0pt,%
backgroundcolor=gray!8!green!5,
innertopmargin=0pt,
linecolor=green!40,%
roundcorner=5pt,%
]{customTheo}{\colorbox{green!40}{Theorem}}[chapter]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%% TOC STYLE %%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\makeatletter
\renewcommand\tableofcontents{%
  \null 
  \begin{tcolorbox}[enhanced,hbox,sharp corners=uphill,
    coltext=black,
    colback=BGF,
    fontupper=\Large\bfseries,arc=6mm,boxrule=2.5mm,boxsep=5mm,
    colframe=FRM,
    right=3cm,
    borderline={0.6mm}{0mm}{black},
    overlay={
        \node[
          fill=FRM,
          line width=0pt,
          inner sep=0pt,
          text width=11cm,
          right=2cm,
          minimum height=1.3mm,
          align=center,
        ] 
        (chapname)
        at ([xshift=7.17cm, yshift=-1.2cm]frame.north west)
        {};
        \node[
          fill=FRM,
          line width=0pt,
          inner sep=0pt,
          text width=8cm,
          right=2cm,
          minimum height=1.3mm,
          align=center,
        ] 
        (chapname)
        at ([xshift=-10cm, yshift=-1.2cm]frame.north west)
        {};
      } 
    ]
 \scalebox{1.6}{\contentsname}
\end{tcolorbox}
  \hfill\null\par
  \@mkboth{\MakeUppercase\contentsname}{\MakeUppercase\contentsname}%
  \@starttoc{toc}%
}

%TOC CONTENT STYLE
\xpatchcmd\l@chapter{#1}{\colorbox{FRM}{\textcolor{white}{#1}}}{}{}

\xpatchcmd\l@section{#1}{\colorbox{BGF}{\textcolor{black}{#1}}}{}{}

\xpatchcmd\l@subsection{#1}{\colorbox{BGF}{\textcolor{black}{#1}}}{}{}


\makeatother
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%    MISC    %%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
